# Google 开源项目规范指南学习

> 1. 头文件
> 2. 作用域
> 3. 类
> 4. 函数
> 5. 奇计
> 6. 其他 C++ 特性
> 7. 命名约定
> 8. 注释
> 9. 格式
> 10. 规则特例



## 1. 头文件

> 1. Self-contained 头文件
> 2. #define 保护
> 3. 前置声明
> 4. 内联函数
> 5. #include 的路径及顺序

通常每一个 `.cpp` 文件都有一个对应的 `.h` 文件

也有一些常见例外, 如单元测试代码和只包含 `main()` 函数的 `.cpp` 文件.

> Linux 常用 `.cc` 后缀的C++文件，Window 常以 `.cpp` 后缀的C++文件。



### 1.1 Self-contained 头文件

> 头文件应该能够自给自足（self-contained,也就是可以作为第一个头文件被引入），以 `.h` 结尾。至于用来插入文本的文件，说到底它们并不是头文件，所以应以 `.inc` 结尾。不允许分离出 `-inl.h` 头文件的做法.

所有头文件要能够自给自足。换言之，用户和重构工具不需要为特别场合而包含额外的头文件。详言之，一个头文件要有 **#define 保护**，统统包含它所需要的其它头文件，也不要求定义任何特别 symbols.

不过有一个例外，即一个文件并不是 self-contained 的，而是作为文本插入到代码某处。或者，文件内容实际上是其它头文件的特定平台（platform-specific）扩展部分。这些文件就要用 `.inc` 文件扩展名。

如果 `.h` 文件声明了一个模板或内联函数，同时也在该文件加以定义。凡是有用到这些的 `.cpp` 文件，就得统统包含该头文件，否则程序可能会在构建中链接失败。不要把这些定义放到分离的 `-inl.h` 文件里。

有个例外：如果某函数模板为所有相关模板参数显式实例化，或本身就是某类的一个私有成员，那么它就只能定义在实例化该模板的 `.cpp` 文件里。



### 1.2 #define 保护

> **Tip：**
>
> 所有头文件应该有 #define 保护防止头文件被多重包含，命名格式位：
>
> **`<PROJECT>_<PATH>_<FILE>_H_`**

为保证唯一性, 头文件的命名应该基于所在项目源代码树的全路径. 例如, 项目 `foo` 中的头文件 `foo/src/bar/baz.h` 可按如下方式保护:

~~~c++
#ifndef FOO_BAR_BAZ_H_
#define FOO_BAR_BAZ_H_
...

#endif FOO_BAR_BAZ_H_
~~~



### 1.3 前置声明

> **Tip：**
>
> 尽可能地避免使用前置声明。使用 `#include` 包含需要的头文件即可。

**定义：**

所谓「前置声明」（forward declaration）是类、函数和模板的纯粹声明，没有伴随着其定义。

**优点：**

- 前置声明能够节省编译时间，多余的 `#include` 会迫使编译器展开更多的文件，处理更多的输入。
- 前置声明能够节省不必要的重新编译的时间。 `#include` 使代码因为头文件中无关的改动而被重新编译多次。

**缺点：**

- 前置声明隐藏了依赖关系，头文件改动时，用户的代码会跳过必要的重新编译过程。
- 前置声明可能会被库的后续更改所破坏。前置声明函数或模板有时会妨碍头文件开发者变动其 API. 例如扩大形参类型，加个自带默认参数的模板形参等等。
- 前置声明来自命名空间 `std::` 的 symbol 时，其行为未定义。
- 很难判断什么时候该用前置声明，什么时候该用 `#include` 。极端情况下，用前置声明代替 `#include` 甚至都会暗暗地改变代码的含义：